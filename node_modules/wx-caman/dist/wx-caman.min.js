function noop(){}function registerBlender(t){t.register("normal",function(t,e){return{r:t.r,g:t.g,b:t.b}}),t.register("multiply",function(t,e){return{r:t.r*e.r/255,g:t.g*e.g/255,b:t.b*e.b/255}}),t.register("screen",function(t,e){return{r:255-(255-t.r)*(255-e.r)/255,g:255-(255-t.g)*(255-e.g)/255,b:255-(255-t.b)*(255-e.b)/255}}),t.register("overlay",function(t,e){var i={};return i.r=e.r>128?255-2*(255-t.r)*(255-e.r)/255:e.r*t.r*2/255,i.g=e.g>128?255-2*(255-t.g)*(255-e.g)/255:e.g*t.g*2/255,i.b=e.b>128?255-2*(255-t.b)*(255-e.b)/255:e.b*t.b*2/255,i}),t.register("difference",function(t,e){return{r:t.r-e.r,g:t.g-e.g,b:t.b-e.b}}),t.register("addition",function(t,e){return{r:e.r+t.r,g:e.g+t.g,b:e.b+t.b}}),t.register("exclusion",function(t,e){return{r:128-2*(e.r-128)*(t.r-128)/255,g:128-2*(e.g-128)*(t.g-128)/255,b:128-2*(e.b-128)*(t.b-128)/255}}),t.register("softLight",function(t,e){var i={};return i.r=e.r>128?255-(255-e.r)*(255-(t.r-128))/255:e.r*(t.r+128)/255,i.g=e.g>128?255-(255-e.g)*(255-(t.g-128))/255:e.g*(t.g+128)/255,i.b=e.b>128?255-(255-e.b)*(255-(t.b-128))/255:e.b*(t.b+128)/255,i}),t.register("lighten",function(t,e){return{r:e.r>t.r?e.r:t.r,g:e.g>t.g?e.g:t.g,b:e.b>t.b?e.b:t.b}}),t.register("darken",function(t,e){return{r:e.r>t.r?t.r:e.r,g:e.g>t.g?t.g:e.g,b:e.b>t.b?t.b:e.b}})}function registerFilter(t){t.register("fillColor",function(){var t=void 0;return t=1===arguments.length?Convert.hexToRGB(arguments.length<=0?void 0:arguments[0]):{r:arguments.length<=0?void 0:arguments[0],g:arguments.length<=1?void 0:arguments[1],b:arguments.length<=2?void 0:arguments[2]},this.process("fillColor",function(e){return e.r=t.r,e.g=t.g,e.b=t.b,e.a=255,e})}),t.register("brightness",function(t){return t=Math.floor(t/100*255),this.process("brightness",function(e){return e.r+=t,e.g+=t,e.b+=t,e})}),t.register("saturation",function(t){return t*=-.01,this.process("saturation",function(e){var i=Math.max(e.r,e.g,e.b);return e.r!==i&&(e.r+=(i-e.r)*t),e.g!==i&&(e.g+=(i-e.g)*t),e.b!==i&&(e.b+=(i-e.b)*t),e})}),t.register("vibrance",function(t){return t*=-1,this.process("vibrance",function(e){var i=Math.max(e.r,e.g,e.b),r=(e.r+e.g+e.b)/3,n=2*Math.abs(i-r)/255*t/100;return e.r!==i&&(e.r+=(i-e.r)*n),e.g!==i&&(e.g+=(i-e.g)*n),e.b!==i&&(e.b+=(i-e.b)*n),e})}),t.register("greyscale",function(){return this.process("greyscale",function(t){var e=Calculate.luminance(t);return t.r=e,t.g=e,t.b=e,t})}),t.register("contrast",function(t){return t=Math.pow((t+100)/100,2),this.process("contrast",function(e){return e.r/=255,e.r-=.5,e.r*=t,e.r+=.5,e.r*=255,e.g/=255,e.g-=.5,e.g*=t,e.g+=.5,e.g*=255,e.b/=255,e.b-=.5,e.b*=t,e.b+=.5,e.b*=255,e})}),t.register("hue",function(t){return this.process("hue",function(e){var i=Convert.rgbToHSV(e.r,e.g,e.b),r=100*i.h;r+=Math.abs(t),r%=100,r/=100,i.h=r;var n=Convert.hsvToRGB(i.h,i.s,i.v),s=n.r,o=n.g,a=n.b;return e.r=s,e.g=o,e.b=a,e})}),t.register("colorize",function(){var t=void 0,e=void 0;return 2===arguments.length?(t=Convert.hexToRGB(arguments.length<=0?void 0:arguments[0]),e=arguments.length<=1?void 0:arguments[1]):4===arguments.length&&(t={r:arguments.length<=0?void 0:arguments[0],g:arguments.length<=1?void 0:arguments[1],b:arguments.length<=2?void 0:arguments[2]},e=arguments.length<=3?void 0:arguments[3]),this.process("colorize",function(i){return i.r-=(i.r-t.r)*(e/100),i.g-=(i.g-t.g)*(e/100),i.b-=(i.b-t.b)*(e/100),i})}),t.register("invert",function(){return this.process("invert",function(t){return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,t})}),t.register("sepia",function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;return t/=100,this.process("sepia",function(e){return e.r=Math.min(255,e.r*(1-.607*t)+e.g*(.769*t)+e.b*(.189*t)),e.g=Math.min(255,e.r*(.349*t)+e.g*(1-.314*t)+e.b*(.168*t)),e.b=Math.min(255,e.r*(.272*t)+e.g*(.534*t)+e.b*(1-.869*t)),e})}),t.register("gamma",function(t){return this.process("gamma",function(e){return e.r=255*Math.pow(e.r/255,t),e.g=255*Math.pow(e.g/255,t),e.b=255*Math.pow(e.b/255,t),e})}),t.register("noise",function(t){return t=2.55*Math.abs(t),this.process("noise",function(e){var i=Calculate.randomRange(-1*t,t);return e.r+=i,e.g+=i,e.b+=i,e})}),t.register("clip",function(t){return t=2.55*Math.abs(t),this.process("clip",function(e){return e.r>255-t?e.r=255:e.r<t&&(e.r=0),e.g>255-t?e.g=255:e.g<t&&(e.g=0),e.b>255-t?e.b=255:e.b<t&&(e.b=0),e})}),t.register("channels",function(t){if("object"!==(void 0===t?"undefined":_typeof(t)))return this;for(var e in t)if(t.hasOwnProperty(e)){if(0===t[e]){delete t[e];continue}t[e]/=100}return 0===t.length?this:this.process("channels",function(e){return t.red&&(t.red>0?e.r+=(255-e.r)*t.red:e.r-=e.r*Math.abs(t.red)),t.green&&(t.green>0?e.g+=(255-e.g)*t.green:e.g-=e.g*Math.abs(t.green)),t.blue&&(t.blue>0?e.b+=(255-e.b)*t.blue:e.b-=e.b*Math.abs(t.blue)),e})}),t.register("curves",function(t){for(var e=arguments.length,i=Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];var n=i[i.length-1],s=void 0;if("function"==typeof n?(s=n,i.pop()):"string"==typeof n?(s=Calculate[n],i.pop()):s=Calculate.bezier,"string"==typeof t&&(t=t.split("")),"v"===t[0]&&(t=["r","g","b"]),i.length<2)throw new Error("Invalid number of arguments to curves filter");var o=s(i,0,255),a=i[0];if(a[0]>0)for(var h=0;h<a[0];h++)o[h]=a[1];var l=i[i.length-1];if(l[0]<255)for(var c=l[0];c<=255;c++)o[c]=l[1];return this.process("curves",function(e){for(var i=0;i<t.length;i++)e[t[i]]=o[e[t[i]]];return e})}),t.register("exposure",function(t){var e=Math.abs(t)/100,i=[0,255*e],r=[255-255*e,255];return t<0&&(i=i.reverse(),r=r.reverse()),this.curves("rgb",[0,0],i,r,[255,255])})}function registerCameraFilter(t){t.register("vignette",function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:60,i=void 0,r=void 0,n=void 0,s=void 0;"string"==typeof t&&"%"===t.substr(-1)&&(t=this.dimensions.height>this.dimensions.width?this.dimensions.width*(parseInt(t.substr(0,t.length-1),10)/100):this.dimensions.height*(parseInt(t.substr(0,t.length-1),10)/100)),e/=100,r=[this.dimensions.width/2,this.dimensions.height/2],s=Math.sqrt(Math.pow(r[0],2)+Math.pow(r[1],2)),n=s-t,i=Calculate.bezier([0,1],[30,30],[70,60],[100,80]),this.process("vignette",function(s){var o,a,h;return h=s.locationXY(),(o=Calculate.distance(h.x,h.y,r[0],r[1]))>n&&(a=Math.max(1,i[Math.round((o-n)/t*100)]/10*e),s.r=255*Math.pow(s.r/255,a),s.g=255*Math.pow(s.g/255,a),s.b=255*Math.pow(s.b/255,a)),s})}),t.register("rectangularVignette",function(t){var e=void 0,i=void 0,r=void 0,n=void 0,s=void 0,o=void 0,a=void 0;if(e={strength:50,cornerRadius:0,method:"brightness",color:{r:0,g:0,b:0}},!(t=Util.extend(e,t)).size)return this;if("string"==typeof t.size)r=parseInt(t.size,10)/100,t.size={width:this.dimensions.width*r,height:this.dimensions.height*r};else if("object"===_typeof(t.size))for(s=0,o=(a=["width","height"]).length;s<o;s++)i=a[s],"string"==typeof t.size[i]&&(t.size[i]=this.dimensions[i]*(parseInt(t.size[i],10)/100));else"number"===t.size&&(n=t.size,t.size={width:n,height:n});"string"==typeof t.cornerRadius&&(t.cornerRadius=t.size.width/2*(parseInt(t.cornerRadius,10)/100)),t.strength/=100,t.size.width=Math.floor(t.size.width),t.size.height=Math.floor(t.size.height),t.image={width:this.dimensions.width,height:this.dimensions.height},"colorize"===t.method&&"string"==typeof t.color&&(t.color=Convert.hexToRGB(t.color)),t.coords={left:(this.dimensions.width-t.size.width)/2,right:this.dimensions.width-t.coords.left,bottom:(this.dimensions.height-t.size.height)/2,top:this.dimensions.height-t.coords.bottom},t.corners=[{x:t.coords.left+t.cornerRadius,y:t.coords.top-t.cornerRadius},{x:t.coords.right-t.cornerRadius,y:t.coords.top-t.cornerRadius},{x:t.coords.right-t.cornerRadius,y:t.coords.bottom+t.cornerRadius},{x:t.coords.left+t.cornerRadius,y:t.coords.bottom+t.cornerRadius}],t.maxDist=Calculate.distance(0,0,t.corners[3].x,t.corners[3].y)-t.cornerRadius,this.process("rectangularVignette",function(e){var i,r;return(r=e.locationXY()).x>t.corners[0].x&&r.x<t.corners[1].x&&r.y>t.coords.bottom&&r.y<t.coords.top?e:r.x>t.coords.left&&r.x<t.coords.right&&r.y>t.corners[3].y&&r.y<t.corners[2].y?e:(r.x>t.corners[0].x&&r.x<t.corners[1].x&&r.y>t.coords.top?i=(r.y-t.coords.top)/t.maxDist:r.y>t.corners[2].y&&r.y<t.corners[1].y&&r.x>t.coords.right?i=(r.x-t.coords.right)/t.maxDist:r.x>t.corners[0].x&&r.x<t.corners[1].x&&r.y<t.coords.bottom?i=(t.coords.bottom-r.y)/t.maxDist:r.y>t.corners[2].y&&r.y<t.corners[1].y&&r.x<t.coords.left?i=(t.coords.left-r.x)/t.maxDist:r.x<=t.corners[0].x&&r.y>=t.corners[0].y?i=(Calculate.distance(r.x,r.y,t.corners[0].x,t.corners[0].y)-t.cornerRadius)/t.maxDist:r.x>=t.corners[1].x&&r.y>=t.corners[1].y?i=(Calculate.distance(r.x,r.y,t.corners[1].x,t.corners[1].y)-t.cornerRadius)/t.maxDist:r.x>=t.corners[2].x&&r.y<=t.corers[2].y?i=(Calculate.distance(r.x,r.y,t.corners[2].x,t.corners[2].y)-t.cornerRadius)/t.maxDist:r.x<=t.corners[3].x&&r.y<=t.corners[3].y&&(i=(Calculate.distance(r.x,r.y,t.corners[3].x,t.corners[3].y)-t.cornerRadius)/t.maxDist),i<0?e:vignetteFilters[t.method](e,i,t))})})}function registerBlurFilter(t){t.register("boxBlur",function(){this.processKernel("Box Blur",[1,1,1,1,1,1,1,1,1])}),t.register("heavyRadialBlur",function(){this.processKernel("Heavy Radial Blur",[0,0,1,0,0,0,1,1,1,0,1,1,1,1,1,0,1,1,1,0,0,0,1,0,0])}),t.register("gaussianBlur",function(){this.processKernel("Gaussian Blur",[1,4,6,4,1,4,16,24,16,4,6,24,36,24,6,4,16,24,16,4,1,4,6,4,1])}),t.register("motionBlur",function(t){var e=void 0;e=0===t||180===t?[0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0]:t>0&&t<90||t>180&&t<270?[0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0]:90===t||270===t?[0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0]:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1],this.processKernel("Motion Blur",e)}),t.register("sharpen",function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;t/=100,this.processKernel("Sharpen",[0,-t,0,-t,4*t+1,-t,0,-t,0])})}function registerPosterizeFilter(t){t.register("posterize",function(t){var e,i;e=256/t,i=255/(t-1),this.process("posterize",function(t){return t.r=Math.floor(Math.floor(t.r/e)*i),t.g=Math.floor(Math.floor(t.g/e)*i),t.b=Math.floor(Math.floor(t.b/e)*i),t})})}function registerPresetFilter(t){t.register("vintage",function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.greyscale(),this.contrast(5),this.noise(3),this.sepia(100),this.channels({red:8,blue:2,green:4}),this.gamma(.87),t&&this.vignette("40%",30)}),t.register("lomo",function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.brightness(15),this.exposure(15),this.curves("rgb",[0,0],[200,0],[155,255],[255,255]),this.saturation(-20),this.gamma(1.8),t&&this.vignette("50%",60),this.brightness(5)}),t.register("clarity",function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.vibrance(20),this.curves("rgb",[5,0],[130,150],[190,220],[250,255]),this.sharpen(15),this.vignette("45%",20),t&&(this.greyscale(),this.contrast(4)),this}),t.register("sinCity",function(){this.contrast(100),this.brightness(15),this.exposure(10),this.posterize(80),this.clip(30),this.greyscale()}),t.register("sunrise",function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.exposure(3.5),this.saturation(-5),this.vibrance(50),this.sepia(60),this.colorize("#e87b22",10),this.channels({red:8,blue:8}),this.contrast(5),this.gamma(1.2),t&&this.vignette("55%",25)}),t.register("crossProcess",function(){this.exposure(5),this.colorize("#e87b22",4),this.sepia(20),this.channels({blue:8,red:3}),this.curves("b",[0,0],[100,150],[180,180],[255,255]),this.contrast(15),this.vibrance(75),this.gamma(1.6)}),t.register("orangePeel",function(){this.curves("rgb",[0,0],[100,50],[140,200],[255,255]),this.vibrance(-30),this.saturation(-30),this.colorize("#ff9000",30),this.contrast(-5),this.gamma(1.4)}),t.register("love",function(){this.brightness(5),this.exposure(8),this.contrast(4),this.colorize("#c42007",30),this.vibrance(50),this.gamma(1.3)}),t.register("grungy",function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.gamma(1.5),this.clip(25),this.saturation(-60),this.contrast(5),this.noise(5),t&&this.vignette("50%",30)}),t.register("jarques",function(){this.saturation(-35),this.curves("b",[20,0],[90,120],[186,144],[255,230]),this.curves("r",[0,0],[144,90],[138,120],[255,255]),this.curves("g",[10,0],[115,105],[148,100],[255,248]),this.curves("rgb",[0,0],[120,100],[128,140],[255,255]),this.sharpen(20)}),t.register("pinhole",function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.greyscale(),this.sepia(10),this.exposure(10),this.contrast(15),t&&this.vignette("60%",35)}),t.register("oldBoot",function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.saturation(-20),this.vibrance(-50),this.gamma(1.1),this.sepia(30),this.channels({red:-10,blue:5}),this.curves("rgb",[0,0],[80,50],[128,230],[255,255]),t&&this.vignette("60%",30)}),t.register("glowingSun",function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.brightness(10),this.newLayer(function(){this.setBlendingMode("multiply"),this.opacity(80),this.copyParent(),this.filter.gamma(.8),this.filter.contrast(50),this.filter.exposure(10)}),this.newLayer(function(){this.setBlendingMode("softLight"),this.opacity(80),this.fillColor("#f49600")}),this.exposure(20),this.gamma(.8),t&&this.vignette("45%",20)}),t.register("hazyDays",function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.gamma(1.2),this.newLayer(function(){this.setBlendingMode("overlay"),this.opacity(60),this.copyParent(),this.filter.channels({red:5}),this.filter.stackBlur(15)}),this.newLayer(function(){this.setBlendingMode("addition"),this.opacity(40),this.fillColor("#6899ba")}),this.newLayer(function(){this.setBlendingMode("multiply"),this.opacity(35),this.copyParent(),this.filter.brightness(40),this.filter.vibrance(40),this.filter.exposure(30),this.filter.contrast(15),this.filter.curves("r",[0,40],[128,128],[128,128],[255,215]),this.filter.curves("g",[0,40],[128,128],[128,128],[255,215]),this.filter.curves("b",[0,40],[128,128],[128,128],[255,215]),this.filter.stackBlur(5)}),this.curves("r",[20,0],[128,158],[128,128],[235,255]),this.curves("g",[20,0],[128,128],[128,128],[235,255]),this.curves("b",[20,0],[128,108],[128,128],[235,255]),t&&this.vignette("45%",20)}),t.register("herMajesty",function(){return this.brightness(40),this.colorize("#ea1c5d",10),this.curves("b",[0,10],[128,180],[190,190],[255,255]),this.newLayer(function(){this.setBlendingMode("overlay"),this.opacity(50),this.copyParent(),this.filter.gamma(.7),this.newLayer(function(){this.setBlendingMode("normal"),this.opacity(60),this.fillColor("#ea1c5d")})}),this.newLayer(function(){this.setBlendingMode("multiply"),this.opacity(60),this.copyParent(),this.filter.saturation(50),this.filter.hue(90),this.filter.contrast(10)}),this.gamma(1.4),this.vibrance(-30),this.newLayer(function(){this.opacity(10),this.fillColor("#e5f0ff")}),this}),t.register("nostalgia",function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.saturation(20),this.gamma(1.4),this.greyscale(),this.contrast(5),this.sepia(100),this.channels({red:8,blue:2,green:4}),this.gamma(.8),this.contrast(5),this.exposure(10),this.newLayer(function(){this.setBlendingMode("overlay"),this.copyParent(),this.opacity(55),this.filter.stackBlur(10)}),t&&this.vignette("50%",30)}),t.register("hemingway",function(){this.greyscale(),this.contrast(10),this.gamma(.9),this.newLayer(function(){this.setBlendingMode("multiply"),this.opacity(40),this.copyParent(),this.filter.exposure(15),this.filter.contrast(15),this.filter.channels({green:10,red:5})}),this.sepia(30),this.curves("rgb",[0,10],[120,90],[180,200],[235,255]),this.channels({red:5,green:-2}),this.exposure(15)}),t.register("concentrate",function(){this.sharpen(40),this.saturation(-50),this.channels({red:3}),this.newLayer(function(){this.setBlendingMode("multiply"),this.opacity(80),this.copyParent(),this.filter.sharpen(5),this.filter.contrast(50),this.filter.exposure(10),this.filter.channels({blue:5})}),this.brightness(10)})}function registerStackBlurPlugin(t){t.register("stackBlur",function(t){var e=void 0,i=void 0,r=void 0,n=void 0,s=void 0,o=void 0,a=void 0,h=void 0,l=void 0,c=void 0,u=void 0,g=void 0,d=void 0,f=void 0,v=void 0,p=void 0,b=void 0,y=void 0,x=void 0,m=void 0,k=void 0,w=void 0,C=void 0,D=void 0,M=void 0,P=void 0,B=void 0,R=void 0,L=void 0,T=void 0,E=void 0,F=void 0,S=void 0,z=void 0,I=void 0,_=void 0,O=void 0,j=void 0,J=void 0,G=void 0,A=void 0,U=void 0,Y=void 0,K=void 0;if(!(isNaN(t)||t<1)){for(t|=0,v=this.pixelData,n=t+t+1,T=(L=this.dimensions.width)-1,l=(h=this.dimensions.height)-1,R=(m=t+1)*(m+1)/2,C=B=new BlurStack,c=_=1;n>=1?_<n:_>n;c=n>=1?++_:--_)C=C.next=new BlurStack,c===m&&(D=C);for(C.next=B,M=null,P=null,I=S=0,u=mulTable[t],w=shgTable[t],F=O=0;h>=0?O<h:O>h;F=h>=0?++O:--O){for(b=s=e=x=a=r=0,y=m*(p=v[S]),o=m*(f=v[S+1]),i=m*(d=v[S+2]),x+=R*p,a+=R*f,r+=R*d,C=B,c=j=0;m>=0?j<m:j>m;c=m>=0?++j:--j)C.r=p,C.g=f,C.b=d,C=C.next;for(c=J=1;m>=1?J<m:J>m;c=m>=1?++J:--J)g=S+((T<c?T:c)<<2),x+=(C.r=p=v[g])*(k=m-c),a+=(C.g=f=v[g+1])*k,r+=(C.b=d=v[g+2])*k,b+=p,s+=f,e+=d,C=C.next;for(M=B,P=D,E=G=0;L>=0?G<L:G>L;E=L>=0?++G:--G)v[S]=x*u>>w,v[S+1]=a*u>>w,v[S+2]=r*u>>w,x-=y,a-=o,r-=i,y-=M.r,o-=M.g,i-=M.b,g=I+((g=E+t+1)<T?g:T)<<2,x+=b+=M.r=v[g],a+=s+=M.g=v[g+1],r+=e+=M.b=v[g+2],M=M.next,y+=p=P.r,o+=f=P.g,i+=d=P.b,b-=p,s-=f,e-=d,P=P.next,S+=4;I+=L}for(E=A=0;L>=0?A<L:A>L;E=L>=0?++A:--A){for(s=e=b=a=r=x=0,y=m*(p=v[S=E<<2]),o=m*(f=v[S+1]),i=m*(d=v[S+2]),x+=R*p,a+=R*f,r+=R*d,C=B,c=U=0;m>=0?U<m:U>m;c=m>=0?++U:--U)C.r=p,C.g=f,C.b=d,C=C.next;for(z=L,c=Y=1;t>=1?Y<=t:Y>=t;c=t>=1?++Y:--Y)S=z+E<<2,x+=(C.r=p=v[S])*(k=m-c),a+=(C.g=f=v[S+1])*k,r+=(C.b=d=v[S+2])*k,b+=p,s+=f,e+=d,C=C.next,c<l&&(z+=L);for(S=E,M=B,P=D,F=K=0;h>=0?K<h:K>h;F=h>=0?++K:--K)v[g=S<<2]=x*u>>w,v[g+1]=a*u>>w,v[g+2]=r*u>>w,x-=y,a-=o,r-=i,y-=M.r,o-=M.g,i-=M.b,g=E+((g=F+m)<l?g:l)*L<<2,x+=b+=M.r=v[g],a+=s+=M.g=v[g+1],r+=e+=M.b=v[g+2],M=M.next,y+=p=P.r,o+=f=P.g,i+=d=P.b,b-=p,s-=f,e-=d,P=P.next,S+=L}return this}})}function registerStackBlurFilter(t){t.register("stackBlur",function(t){this.processPlugin("stackBlur",[t])})}function registerPlugin(t){registerStackBlurPlugin(t)}function registerPluginFilter(t){registerCameraFilter(t),registerBlurFilter(t),registerPosterizeFilter(t),registerPresetFilter(t),registerStackBlurFilter(t)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}(),inherits=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},possibleConstructorReturn=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},moduleKeywords=["extended","included"],Module=function(){function t(){classCallCheck(this,t)}return createClass(t,null,[{key:"extends",value:function(t){for(var e in t)-1===moduleKeywords.indexOf&&(this[e]=t[e]);return t.extended&&t.extended.apply(this),this}},{key:"includes",value:function(t){for(var e in t)-1===moduleKeywords.indexOf&&(this.prototype[e]=t[e]);return t.included&&t.included.apply(this),this}},{key:"delegate",value:function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];var r=e.pop();for(var n in e){var s=e[n];this.prototype[s]=r.prototype[s]}}},{key:"aliasFunction",value:function(t,e){var i=this;this.prototype[t]=function(){for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];i.prototype[e].apply(i,r)}}},{key:"aliasProperty",value:function(t,e){Object.defineProperty(this.prototype,t,{get:function(){return this[e]},set:function(t){this[e]=t}})}},{key:"included",value:function(t){t.call(this,this.prototype)}}]),t}(),Util=function(){function t(){classCallCheck(this,t)}return createClass(t,null,[{key:"uniqid",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7;return Math.random().toString(35).substr(2,t)}},{key:"extend",value:function(t){for(var e=t,i=arguments.length,r=Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];for(var s in r){var o=r[s];for(var a in o)o.hasOwnProperty(a)&&(e[a]=o[a])}return e}},{key:"clampRGB",value:function(t){return t<0?0:t>255?255:t}},{key:"copyAttributes",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};for(var r in t.attributes){var n=t.attributes[r];i.except&&-1!==i.except.indexOf(n.nodeName)||e.setAttribute(n.nodeName,n.nodeValue)}}},{key:"dataArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return Uint8ClampedArray?new Uint8ClampedArray(t):new Array(t)}}]),t}(),Analyze=function(){function t(e){classCallCheck(this,t),this.c=e}return createClass(t,[{key:"calculateLevels",value:function(){for(var t={r:{},g:{},b:{}},e=0;e<=255;e++)t.r[e]=0,t.g[e]=0,t.b[e]=0;for(var i=0,r=this.c.pixelData.length;i<r;i+=4)t.r[this.c.pixelData[i]]++,t.g[this.c.pixelData[i+1]]++,t.b[this.c.pixelData[i+2]]++;for(var n=this.c.pixelData.length/4,s=0;s<=255;s++)t.r[s]/=n,t.g[s]/=n,t.b[s]/=n;return t}}]),t}(),Event=function(){function t(){classCallCheck(this,t)}return createClass(t,null,[{key:"trigger",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this.events[e]&&this.events[e].length)for(var r in this.events[e]){var n=this.events[e][r];null!==n.target&&t.id!==n.target.id||n.fn.call(t,i)}}},{key:"listen",value:function(t,e,i){if("string"==typeof t){var r=t,n=e;t=null,e=r,i=n}return-1!==this.types.indexOf(e)&&(this.events[e]||(this.events[e]=[]),this.events[e].push({target:t,fn:i}),!0)}},{key:"once",value:function(t,e,i){function r(){n.off(t,e,r),i.apply(n,arguments)}var n=this;r.fn=i,this.listen(t,e,r)}},{key:"off",value:function(t,e,i){if(!arguments.length)return void(this.events=Object.create(null));if("string"==typeof t){var r=t,n=e;t=null,e=r,i=n}var s=this.events[e];if(s)if(i){for(var o=void 0,a=s.length;a--;)if((o=s[a])===i||o.fn===i){s.splice(a,1);break}}else this.events[e]=null}}]),t}();Object.defineProperty(Event,"events",{enumerable:!0,writable:!0,value:{}}),Object.defineProperty(Event,"types",{enumerable:!0,writable:!0,value:["processStart","processComplete","renderStart","renderFinished","blockStarted","blockFinished","_pixelDataReady"]});var Config={DEBUG:!1,FILTER_TYPE:{Single:1,Kernel:2,LayerDequeue:3,LayerFinished:4,LoadOverlay:5,Plugin:6}},Logger=function t(){var e=this;classCallCheck(this,t);var i=["log","info","warn","error"];for(var r in i)!function(t){var r=i[t];e[r]=function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i]}}(r);this.debug=this.log},Log=new Logger,Plugin=function(){function t(){classCallCheck(this,t)}return createClass(t,null,[{key:"register",value:function(t,e){this.plugins[t]=e}},{key:"execute",value:function(t,e,i){this.plugins[e].apply(t,i)}}]),t}();Object.defineProperty(Plugin,"plugins",{enumerable:!0,writable:!0,value:{}});var Pixel=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;classCallCheck(this,t),this.loc=0,this.r=e,this.g=i,this.b=r,this.a=n,this.c=s}return createClass(t,null,[{key:"coordinatesToLocation",value:function(t,e,i){return 4*(e*i+t)}},{key:"locationToCoordinates",value:function(t,e){return{x:t%(4*e)/4,y:Math.floor(t/(4*e))}}}]),createClass(t,[{key:"setContext",value:function(t){this.c=t}},{key:"locationXY",value:function(){if(!this.c)throw new Error("Requires a CamanJS context");var t=this.c.dimensions.height-Math.floor(this.loc/(4*this.c.dimensions.width));return{x:this.loc%(4*this.c.dimensions.width)/4,y:t}}},{key:"pixelAtLocation",value:function(e){if(!this.c)throw new Error("Requires a CamanJS context");return new t(this.c.pixelData[e],this.c.pixelData[e+1],this.c.pixelData[e+2],this.c.pixelData[e+3],this.c)}},{key:"getPixelRelative",value:function(e,i){if(!this.c)throw new Error("Requires a CamanJS context");var r=this.loc+4*this.c.dimensions.width*(-1*i)+4*e;return r>this.c.pixelData.length||r<0?new t(0,0,0,255,this.c):this.pixelAtLocation(r)}},{key:"getPixel",value:function(t,e){if(!this.c)throw new Error("Requires a CamanJS context");var i=this.coordinatesToLocation(t,e,this.width);return this.pixelAtLocation(i)}},{key:"putPixel",value:function(t,e,i){if(!this.c)throw new Error("Requires a CamanJS context");var r=this.coordinatesToLocation(t,e,this.width);this.c.pixelData[r]=i.r,this.c.pixelData[r+1]=i.g,this.c.pixelData[r+2]=i.b,this.c.pixelData[r+3]=i.a}},{key:"toString",value:function(){this.toKey()}},{key:"toHex",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e="#"+this.r.toString(16)+this.g.toString(16)+this.b.toString(16);return t&&(e+=this.a.toString(16)),e}}],[{key:"putPixelRelative",value:function(t,e,i){if(!this.c)throw new Error("Requires a CamanJS context");var r=this.loc+4*this.c.dimensions.width*(-1*e)+4*t;if(!(r>this.c.pixelData.length||r<0))return this.c.pixelData[r]=i.r,this.c.pixelData[r+1]=i.g,this.c.pixelData[r+2]=i.b,this.c.pixelData[r+3]=i.a,!0}}]),t}(),Renderer=function(){function t(e){classCallCheck(this,t),this.c=e,this.renderQueue=[],this.modPixelData=null}return createClass(t,[{key:"add",value:function(t){t&&this.renderQueue.push(t)}},{key:"processNext",value:function(){if(0===this.renderQueue.length)return Event.trigger(this,"renderFinished"),this.finishedFn&&this.finishedFn.call(this.c),this;switch(this.currentJob=this.renderQueue.shift(),this.currentJob.type){case Config.FILTER_TYPE.LayerDequeue:var t=this.c.canvasQueue.shift();this.c.executeLayer(t),this.processNext();break;case Config.FILTER_TYPE.LayerFinished:this.c.applyCurrentLayer(),this.c.popContext(),this.processNext();break;case Config.FILTER_TYPE.LoadOverlay:this.loadOverlay(this.currentJob.layer,this.currentJob.src);break;case Config.FILTER_TYPE.Plugin:this.executePlugin();break;default:this.executeFilter()}}},{key:"execute",value:function(t,e){var i=this;this.finishedFn=e,Event.listen(t,"_pixelDataReady",function(){i.modPixelData=Util.dataArray(i.c.pixelData.length),i.processNext()})}},{key:"eachBlock",value:function(e){var i=this;this.blocksDone=0;for(var r=this.c.pixelData.length,n=4*Math.floor(r/4/t.Blocks),s=n+r/4%t.Blocks*4,o=0;o<t.Blocks;o++)!function(r){var o=r*n,a=o+(r===t.Blocks-1?s:n);setTimeout(function(){e.call(i,r,o,a)},0)}(o)}},{key:"executeFilter",value:function(){Event.trigger(this.c,"processStart",this.currentJob),this.currentJob.type===Config.FILTER_TYPE.Single?this.eachBlock(this.renderBlock):this.eachBlock(this.renderKernel)}},{key:"executePlugin",value:function(){Log.debug("Executing plugin "+this.currentJob.plugin),Plugin.execute(this.c,this.currentJob.plugin,this.currentJob.args),Log.debug("Plugin "+this.currentJob.plugin+" finished!"),this.processNext()}},{key:"renderBlock",value:function(e,i,r){Log.debug("Block #"+e+" - Filter: "+this.currentJob.name+", Start: "+i+", End: "+r),Event.trigger(this.c,"blockStarted",{blockNum:e,totalBlocks:t.Blocks,startPixel:i,endPixel:r});var n=new Pixel;n.setContext(this.c);for(var s=i;s<r;s+=4)n.loc=s,n.r=this.c.pixelData[s],n.g=this.c.pixelData[s+1],n.b=this.c.pixelData[s+2],n.a=this.c.pixelData[s+3],this.currentJob.processFn(n),this.c.pixelData[s]=Util.clampRGB(n.r),this.c.pixelData[s+1]=Util.clampRGB(n.g),this.c.pixelData[s+2]=Util.clampRGB(n.b),this.c.pixelData[s+3]=Util.clampRGB(n.a);this.blockFinished(e)}},{key:"renderKernel",value:function(t,e,i){var r=this.currentJob.bias,n=this.currentJob.divisor,s=this.c.pixelData.length,o=this.currentJob.adjust,a=Math.sqrt(o.length),h=[];Log.debug("Rendering kernel - Filter: "+this.currentJob.name),e=Math.max(e,4*this.c.dimensions.width*((a-1)/2)),i=Math.min(i,s-4*this.c.dimensions.width*((a-1)/2));var l=(a-1)/2,c=new Pixel;c.setContext(this.c);for(var u=e;u<i;u+=4){c.loc=u;for(var g=0,d=-l;d<=l;d++)for(var f=l;f>=-l;f--){var v=c.getPixelRelative(d,f);h[3*g]=v.r,h[3*g+1]=v.g,h[3*g+2]=v.b,g++}var p=this.processKernel(o,h,n,r);this.modPixelData[u]=Util.clampRGB(p.r),this.modPixelData[u+1]=Util.clampRGB(p.g),this.modPixelData[u+2]=Util.clampRGB(p.b),this.modPixelData[u+3]=this.c.pixelData[u+3]}this.blockFinished(t)}},{key:"blockFinished",value:function(e){if(e>=0&&Log.debug("Block #"+e+" finished! Filter: "+this.currentJob.name),this.blocksDone++,Event.trigger(this.c,"blockFinished",{blockNum:e,blocksFinished:this.blocksDone,totalBlocks:t.Blocks}),this.blocksDone===t.Blocks){if(this.currentJob.type===Config.FILTER_TYPE.Kernel)for(var i=0;i<this.c.pixelData.length;i++)this.c.pixelData[i]=this.modPixelData[i];e>=0&&Log.debug("Filter "+this.currentJob.name+" finished!"),Event.trigger(this.c,"processComplete",this.currentJob),this.processNext()}}},{key:"processKernel",value:function(t,e,i,r){for(var n={r:0,g:0,b:0},s=0;s<t.length;s++)n.r+=t[s]*e[3*s],n.g+=t[s]*e[3*s+1],n.b+=t[s]*e[3*s+2];return n.r=n.r/i+r,n.g=n.g/i+r,n.b=n.b/i+r,n}}]),t}();Object.defineProperty(Renderer,"Blocks",{enumerable:!0,writable:!0,value:4});var Blender=function(){function t(){classCallCheck(this,t)}return createClass(t,null,[{key:"register",value:function(t,e){this.blenders[t]=e}},{key:"execute",value:function(t,e,i){return this.blenders[t](e,i)}}]),t}();Object.defineProperty(Blender,"blenders",{enumerable:!0,writable:!0,value:{}});var Layer=function(){function t(e){classCallCheck(this,t),this.c=e,this.filter=e,this.options={blendingMode:"normal",opacity:1},this.layerID=Util.uniqid(),this.width=this.c.dimensions.width,this.height=this.c.dimensions.height,this.pixelData=new Uint8ClampedArray(this.c.pixelData.length)}return createClass(t,[{key:"newLayer",value:function(t){this.c.newLayer(t)}},{key:"setBlendingMode",value:function(t){return this.options.blendingMode=t,this}},{key:"opacity",value:function(t){return this.options.opacity=t/100,this}},{key:"copyParent",value:function(){for(var t=this.pixelData,e=0;e<this.c.pixelData.length;e+=4)this.pixelData[e]=t[e],this.pixelData[e+1]=t[e+1],this.pixelData[e+2]=t[e+2],this.pixelData[e+3]=t[e+3];return this}},{key:"fillColor",value:function(){this.c.fillColor.apply(this.c,arguments)}},{key:"applyToParent",value:function(){for(var t=this.c.pixelStack[this.c.pixelStack.length-1],e=this.c.pixelData,i=0;i<e.length;i+=4){var r={r:t[i],g:t[i+1],b:t[i+2],a:t[i+3]},n={r:e[i],g:e[i+1],b:e[i+2],a:e[i+3]},s=Blender.execute(this.options.blendingMode,n,r);s.r=Util.clampRGB(s.r),s.g=Util.clampRGB(s.g),s.b=Util.clampRGB(s.b),s.a||(s.a=n.a),t[i]=r.r-(r.r-s.r)*(this.options.opacity*(s.a/255)),t[i+1]=r.g-(r.g-s.g)*(this.options.opacity*(s.a/255)),t[i+2]=r.b-(r.b-s.b)*(this.options.opacity*(s.a/255))}}}]),t}(),Caman=function(t){function e(){var t;classCallCheck(this,e);for(var i=arguments.length,r=Array(i),n=0;n<i;n++)r[n]=arguments[n];if(0===r.length)throw new Error("Invalid arguments");var s=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),o=r[3];return"function"!=typeof o&&(o=noop),s.id=Util.uniqid(),s.initializedPixelData=s.originalPixelData=null,s.pixelStack=[],s.layerStack=[],s.canvasQueue=[],s.currentLayer=null,s.analyze=new Analyze(s),s.renderer=new Renderer(s),s.parseArguments(r),s.initCanvas(),t=s,possibleConstructorReturn(s,t)}return inherits(e,t),createClass(e,null,[{key:"toString",value:function(){return"Version "+e.version.release+", Released "+e.version.date}}]),createClass(e,[{key:"parseArguments",value:function(t){if(0===t.length)throw new Error("Invalid arguments given");if("string"!=typeof t[0])throw new Error("You must pass the canvas-id as the first argument.");if(this.canvas=t[0],"number"!=typeof t[1]||"number"!=typeof t[2])throw new Error("You must pass the width and height of the canvas component.");this.width=t[1],this.height=t[2],this.callback="function"==typeof t[3]?t[3]:noop}},{key:"initCanvas",value:function(){this.context=wx.createCanvasContext(this.canvas),this.finishInit()}},{key:"finishInit",value:function(){this.context||(this.context=wx.createCanvasContext(this.canvas)),this.originalWidth=this.preScaledWidth=this.width,this.originalHeight=this.preScaledHeight=this.height;var t=this;wx.canvasGetImageData({canvasId:t.canvas,x:0,y:0,width:t.width,height:t.height,success:function(i){if(t.pixelData=i.data,Event.trigger(t,"_pixelDataReady"),e.allowRevert){t.initializedPixelData=Util.dataArray(t.pixelData.length),t.originalPixelData=Util.dataArray(t.pixelData.length);for(var r=0;r<t.pixelData.length;r++){var n=t.pixelData[r];t.initializedPixelData[r]=n,t.originalPixelData[r]=n}}}}),this.dimensions={width:this.width,height:this.height},this.callback(this),this.callback=noop}},{key:"resetOriginalPixelData",value:function(){if(!e.allowRevert)throw new Error("Revert disabled");this.originalPixelData=Util.dataArray(this.pixelData.length);for(var t=0;t<this.pixelData.length;t++){var i=this.pixelData[t];this.originalPixelData[t]=i}}},{key:"render",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:noop;Event.trigger(this,"renderStart"),this.renderer.execute(this,function(){var i=t;wx.canvasPutImageData({canvasId:i.canvas,data:i.pixelData,x:0,y:0,width:i.width,height:i.height,success:function(){e.call(i)}})})}},{key:"reset",value:function(){for(var t=0;t<this.initializedPixelData.length;t++){var e=this.initializedPixelData[t];this.pixelData[t]=e}var i=this;wx.canvasPutImageData({canvasId:i.canvas,data:this.pixelData,x:0,y:0,width:i.width,height:i.height})}},{key:"process",value:function(t,e){return this.renderer.add({type:Config.FILTER_TYPE.Single,name:t,processFn:e}),this}},{key:"processKernel",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!i){i=0;for(var n=0;n<=e.length;n++)i+=e[n]}return this.renderer.add({type:Config.FILTER_TYPE.Kernel,name:t,adjust:e,divisor:i,bias:r}),this}},{key:"processPlugin",value:function(t,e){return this.renderer.add({type:Config.FILTER_TYPE.Plugin,plugin:t,args:e}),this}},{key:"newLayer",value:function(t){var e=this;return Event.listen(this,"_pixelDataReady",function(){var i=new Layer(e);e.canvasQueue.push(i),e.renderer.add({type:Config.FILTER_TYPE.LayerDequeue}),t.call(i),e.renderer.add({type:Config.FILTER_TYPE.LayerFinished})}),this}},{key:"executeLayer",value:function(t){this.pushContext(t)}},{key:"pushContext",value:function(t){this.layerStack.push(this.currentLayer),this.pixelStack.push(this.pixelData),this.currentLayer=t,this.pixelData=t.pixelData}},{key:"popContext",value:function(){this.pixelData=this.pixelStack.pop(),this.currentLayer=this.layerStack.pop()}},{key:"applyCurrentLayer",value:function(){this.currentLayer.applyToParent()}}]),e}(Module);Object.defineProperty(Caman,"version",{enumerable:!0,writable:!0,value:{release:"1.0.0",date:"6/08/2018"}}),Object.defineProperty(Caman,"allowRevert",{enumerable:!0,writable:!0,value:!0});var Filter=function(){function t(){classCallCheck(this,t)}return createClass(t,null,[{key:"register",value:function(t,e){Caman.prototype[t]=e}}]),t}(),Convert=function(){function t(){classCallCheck(this,t)}return createClass(t,null,[{key:"hexToRGB",value:function(t){return"#"===t.charAt(0)&&(t=t.substr(1)),{r:parseInt(t.substr(0,2),16),g:parseInt(t.substr(2,2),16),b:parseInt(t.substr(4,2),16)}}},{key:"rgbToHSL",value:function(t,e,i){"object"===(void 0===t?"undefined":_typeof(t))&&(e=t.g,i=t.b,t=t.r),t/=255,e/=255,i/=255;var r=Math.max(t,e,i),n=Math.min(t,e,i),s=(r+n)/2,o=void 0,a=void 0;if(r===n)o=a=0;else{var h=r-n;a=s>.5?h/(2-r-n):h/(r+n),r===t?o=(e-i)/h+e<i?6:0:r===e?o=(i-t)/h+2:r===i&&(o=(t-e)/h+4),o/=6}return{h:o,s:a,l:s}}},{key:"hslToRGB",value:function(t,e,i){var r=void 0,n=void 0,s=void 0,o=void 0,a=void 0;return"object"===(void 0===t?"undefined":_typeof(t))&&(e=t.s,i=t.l,t=t.h),0===e?r=n=s=i:(o=2*i-(a=i<.5?i*(1+e):i+e-i*e),r=this.hueToRGB(o,a,t+1/3),n=this.hueToRGB(o,a,t),s=this.hueToRGB(o,a,t-1/3)),{r:255*r,g:255*n,b:255*s}}},{key:"hueToRGB",value:function(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}},{key:"rgbToHSV",value:function(t,e,i){t/=255,e/=255,i/=255;var r=Math.max(t,e,i),n=Math.min(t,e,i),s=r,o=r-n,a=0===r?0:o/r,h=void 0;return r===n?h=0:(r===t?h=(e-i)/o+e<i?6:0:r===e?h=(i-t)/o+2:r===i&&(h=(t-e)/o+4),h/=6),{h:h,s:a,v:s}}},{key:"hsvToRGB",value:function(t,e,i){var r=Math.floor(6*t),n=6*t-r,s=i*(1-e),o=i*(1-n*e),a=i*(1-(1-n)*e),h=void 0,l=void 0,c=void 0;switch(r%6){case 0:h=i,l=a,c=s;break;case 1:h=o,l=i,c=s;break;case 2:h=s,l=i,c=a;break;case 3:h=s,l=o,c=i;break;case 4:h=a,l=s,c=i;break;case 5:h=i,l=s,c=o}return{r:Math.floor(255*h),g:Math.floor(255*l),b:Math.floor(255*c)}}},{key:"rgbToXYZ",value:function(t,e,i){return e/=255,i/=255,(t/=255)>.04045?t=Math.pow((t+.055)/1.055,2.4):t/=12.92,e>.04045?e=Math.pow((e+.055)/1.055,2.4):e/=12.92,i>.04045?i=Math.pow((i+.055)/1.055,2.4):i/=12.92,{x:100*(.4124*t+.3576*e+.1805*i),y:100*(.2126*t+.7152*e+.0722*i),z:100*(.0193*t+.1192*e+.9505*i)}}},{key:"xyzToRGB",value:function(t,e,i){var r=3.2406*(t/=100)+-1.5372*(e/=100)+-.4986*(i/=100),n=-.9689*t+1.8758*e+.0415*i,s=.0557*t+-.204*e+1.057*i;return r>.0031308?r=1.055*Math.pow(r,.4166666667)-.055:r*=12.92,n>.0031308?n=1.055*Math.pow(n,.4166666667)-.055:n*=12.92,s>.0031308?s=1.055*Math.pow(s,.4166666667)-.055:s*=12.92,{r:255*r,g:255*n,b:255*s}}},{key:"xyzToLab",value:function(t,e,i){"object"===(void 0===t?"undefined":_typeof(t))&&(e=t.y,i=t.z,t=t.x);return e/=100,i/=108.883,t=(t/=95.047)>.008856451679?Math.pow(t,.3333333333):7.787037037*t+.1379310345,{l:116*(e=e>.008856451679?Math.pow(e,.3333333333):7.787037037*e+.1379310345)-16,a:500*(t-e),b:200*(e-(i=i>.008856451679?Math.pow(i,.3333333333):7.787037037*i+.1379310345))}}},{key:"labToXYZ",value:function(t,e,i){"object"===(void 0===t?"undefined":_typeof(t))&&(e=t.a,i=t.b,t=t.l);var r=(t+16)/116,n=r+e/500,s=r-i/200;return n>.2068965517?n*=n*n:n=.1284185493*(n-.1379310345),r>.2068965517?r*=r*r:r=.1284185493*(r-.1379310345),s>.2068965517?s*=s*s:s=.1284185493*(s-.1379310345),{x:95.047*n,y:100*r,z:108.883*s}}},{key:"rgbToLab",value:function(t,e,i){"object"===(void 0===t?"undefined":_typeof(t))&&(e=t.g,i=t.b,t=t.r);var r=this.rgbToXYZ(t,e,i);return this.xyzToLab(r)}}]),t}(),Calculate=function(){function t(){classCallCheck(this,t)}return createClass(t,null,[{key:"distance",value:function(t,e,i,r){return Math.sqrt(Math.pow(i-t,2)+Math.pow(r-e,2))}},{key:"randomRange",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=t+Math.random()*(e-t);return i?r.toFixed(i):Math.round(r)}},{key:"luminance",value:function(t){return.299*t.r+.587*t.g+.114*t.b}},{key:"bezier",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:255;if(e.length<2)throw new Error("Invalid number of arguments to bezier");for(var n={},s=function(t,e,i){return t*(1-i)+e*i},o=0;o<1e3;o++){for(var a=o/1e3,h=e;h.length>1;){for(var l=[],c=0;c<=h.length-2;c++)l.push([s(h[c][0],h[c+1][0],a),s(h[c][1],h[c+1][1],a)]);h=l}n[Math.round(h[0][0])]=Math.round(function(t,e,i){return Math.min(Math.max(t,e),i)}(h[0][1],i,r))}var u=e[e.length-1][0];return n=t.missingValues(n,u),n[u]||(n[u]=n[u-1]),n}},{key:"missingValues",value:function(t,e){if(Object.keys(t).length<e+1){for(var i={},r=void 0,n=void 0,s=0;s<=e;s++)if(t[s])i[s]=t[s];else{r=[s-1,i[s-1]];for(var o=s;o<=e;o++)if(t[o]){n=[o,t[o]];break}i[s]=r[1]+(n[1]-r[1])/(n[0]-r[0])*(s-r[0])}return i}return t}}]),t}(),vignetteFilters={brightness:function(t,e,i){return t.r=t.r-t.r*e*i.strength,t.g=t.g-t.g*e*i.strength,t.b=t.b-t.b*e*i.strength,t},gamma:function(t,e,i){return t.r=255*Math.pow(t.r/255,Math.max(10*e*i.strength,1)),t.g=255*Math.pow(t.g/255,Math.max(10*e*i.strength,1)),t.b=255*Math.pow(t.b/255,Math.max(10*e*i.strength,1)),t},colorize:function(t,e,i){return t.r-=(t.r-i.color.r)*e,t.g-=(t.g-i.color.g)*e,t.b-=(t.b-i.color.b)*e,t}},BlurStack=void 0,mulTable=void 0,shgTable=void 0;if(mulTable=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],shgTable=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24],BlurStack=function(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null},"undefined"==typeof wx)throw new Error("Wechat-CamanJS can only run in wechat mini program");registerBlender(Blender),registerFilter(Filter),registerPlugin(Plugin),registerPluginFilter(Filter);export default Caman;
